<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel="stylesheet" href="style.css">
        <title> TETRIS </title>
        <!-----Aquesta funcio crida al nostre js --->

    </head>
    <body>
        <div style="text-align: center;">
            <h1 style="color: blanchedalmond; border: 1px solid greenyellow;">TETRIS GAME</h1>

            <div id="tauler"></div>
        </div>
        <script>
            var Principal = {
                espaiJoc: [
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                ],
                puntuacio: 0,
                Maxpun: localStorage.getItem("Maxima") == undefined ? 0 : localStorage.getItem("Maxima"),
                //localStorage.setItem("Maxima", punt);
                // var maxi = localStorage.getItem("Maxima");
                //document.getElementById("max").innerHTML = "<h3>La puntuacio Maxima obtinguda maxima es: " + maxi + "</h3>";
                //segons el tipus de peça un num. o un altre
                pecaJoc: {},
                peçaSeguent: {},
                contador: [0, 0, 0, 0, 0, 0, 0],
                nivell: 0,
                borrarMapapeca: function () {
                    for (var i = this.espaiJoc.length - 1; i >= 0; i--) {

                        for (var c = this.espaiJoc[i].length - 1; c >= 0; c--) {
                            if (this.espaiJoc[i][c] === 1) {
                                this.espaiJoc[i][c] = 0;
                            }
                        }
                    }
                },
                bloquejarPeca: function () {
                    for (var i = this.espaiJoc.length - 1; i >= 0; i--) {

                        for (var c = this.espaiJoc[i].length - 1; c >= 0; c--) {
                            if (this.espaiJoc[i][c] === 1) {
                                this.espaiJoc[i][c] = 2;
                            }
                        }
                    }
                },
                inicialitzarJoc: function () {



                    var pa = GeneraPecaAleatoria();
                    this.pecaJoc = new Peça(pa[0], pa[1], 0, 3);
                    pa = GeneraPecaAleatoria();
                    this.peçaSeguent = new Peça(pa[0], pa[1], 0, 3);
                },
                pintarMapa: function () {
                    var fila = "<table id='taul' border='1'>";
                    for (var i = 0; i < this.espaiJoc.length; i++) {
                        fila += "<tr>";
                        for (var c = 0; c < this.espaiJoc[i].length; c++) {
                            fila += "<td>";
                            if (this.espaiJoc[i][c] === 0) {
                                fila += "&nbsp;</td>";
                            } else if (this.espaiJoc[i][c] === 1) {
                                fila += "P</td>";
                            } else if (this.espaiJoc[i][c] === 2) {
                                fila += "X</td>";
                            }
                        }
                        fila += "</tr>";
                    }
                    fila += "</table>";
                    return fila;
                },
                teclat: function () {

                },
                posicioCorrecte: function () {

                    for (var i = 0; i < this.pecaJoc.forma.length; i++)
                    {

                        for (var j = 0; j < this.pecaJoc.forma[i].length; j++)
                        {
                            if (this.pecaJoc.forma[i][j] !== 0) {

                                if (this.pecaJoc.x + i < 0 || this.pecaJoc.x + i > 24) {
                                    return false;
                                }
                                if (this.pecaJoc.y + j < 0 || this.pecaJoc.y + j > 9) {
                                    return false;
                                }
                                if (this.espaiJoc[(this.pecaJoc.x + i)][(this.pecaJoc.y + j)] !== 0) {
                                    return false;
                                }
                            }
                        }
                    }
                    return true;
                },
                movimentAutomatic: function () {
                    /*
                     
                     */
                    this.pecaJoc.pintar();
                    this.pecaJoc.moureAvall();
                    this.borrarMapapeca();
                    if (this.posicioCorrecte()) {
                        this.pecaJoc.pintar();
                    } else {
                        this.pecaJoc.moureAmunt();
                        this.pecaJoc.pintar();
                        this.bloquejarPeca();
                        this.pecaJoc = this.peçaSeguent;
                        pa = GeneraPecaAleatoria();
                        this.peçaSeguent = new Peça(pa[0], pa[1], 0, 3);
                    }
                }
            }
            ;
//------        AQUI TENIM LA PEÇA DECLARADA    -----/

            var Peça = function (forma, color, x, y)
            {
                this.forma = forma;
                this.color = color;
                this.x = x;
                this.y = y;
            };
            Peça.prototype.moureEsquerra = function ()
            {
                if ((this.x - 1) > 0) {
                    this.x--;
                } else {
                    return false;
                }
            };
            Peça.prototype.moureDreta = function ()
            {
                if ((this.x + 1) < 14) {
                    this.x++;
                    return true;
                } else {
                    return false;
                }
            };
            Peça.prototype.moureAvall = function ()
            {
                if ((this.x + 1) < 25) {
                    this.x++;
                    return true;
                } else {
                    return false;
                }


            };
            Peça.prototype.moureAmunt = function ()
            {

                this.x--;

            };
            Peça.prototype.pintar = function ()
            {


                for (var i = 0; i < this.forma.length; i++)
                {

                    for (var j = 0; j < this.forma[i].length; j++)
                    {

                        if (this.forma[i][j] === 1) {

                            //per veure les posicions que tenen i sumem la posicio x de la peça amb la que ocupa a la seva array i la posem al mapa.
                            //console.log("posicio i=" + i + " posicio j=" + j);
                            //console.log("x+i:" + (this.x + i) + " y+j:" + (this.y + j));
                            Principal.espaiJoc[(this.x + i)][(this.y + j)] = 1;
                        }

                    }

                }
            };
            Peça.prototype.rotarDreta = function () {
                var formaNova = new Array();
                for (var i = 0; i < this.forma.length; i++) {
                    formaNova[i] = new Array();
                    for (var j = 0; j < this.forma[i].length; j++) {
                        formaNova[i][j] = this.forma[this.forma[i].length - 1 - j][i];
                    }
                }
                this.forma = formaNova;
            };
            Peça.prototype.rotarEsquerra = function () {


                this.rotarDreta();
                this.rotarDreta();
                this.rotarDreta();
            };
            function GeneraPecaAleatoria()
            {
                var peces = [
                    [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "groc"],
                    [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0]], "lila"],
                    [[[0, 0, 0, 0], [0, 1, 1, 0], [1, 1, 0, 0], [0, 0, 0, 0]], "verd"],
                    [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 0, 1, 1], [0, 0, 0, 0]], "roig"],
                    [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "blau"],
                    [[[0, 1, 1, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "taronga"],
                    [[[0, 0, 0, 0], [1, 1, 1, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "morat"]];
                var numeroAleatori = Math.round(Math.random() * 6);
                return peces[numeroAleatori];
            }
            ;
            //per generar peça aleatoria var pa = GeneraPecaAleatoria();
            // per generar una nova peeça var p = new Peça(pa[0],pa[1],0,0);
            //document.write(p.pintar());

            Principal.inicialitzarJoc();
            function joc() {
                document.getElementById("tauler").innerHTML = Principal.pintarMapa();
                Principal.movimentAutomatic();
            }
            ;
            var loop = setInterval(joc, 1000);


            //      p.rotarEsquerra();
            //   document.getElementById("esquerra").innerHTML = p.pintar();


        </script>

        <noscript>
        <p>HOLA</p>
        <p>La página que estás viendo requiere para su funcionamiento el uso de JavaScript. 
            Si lo has deshabilitado intencionadamente, por favor vuelve a activarlo.</p>
        </noscript>
    </body>
</html>